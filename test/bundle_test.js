/* env:test version:v-2025-08-25-12-23-ajout-message-publish-webflow */
(()=>{var q=Object.defineProperty,nt=Object.defineProperties;var ot=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var at=Object.prototype.hasOwnProperty,rt=Object.prototype.propertyIsEnumerable;var B=(t,e,n)=>e in t?q(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,_=(t,e)=>{for(var n in e||(e={}))at.call(e,n)&&B(t,n,e[n]);if(R)for(var n of R(e))rt.call(e,n)&&B(t,n,e[n]);return t},k=(t,e)=>nt(t,ot(e));var st=(t,e)=>{for(var n in e)q(t,n,{get:e[n],enumerable:!0})};var it=(()=>{let t=[0],e=0,n=50;for(let o=1;o<35;o+=1)e+=n,t.push(e),n+=10;return t})(),lt={QUESTION_COUNT:20,XP_PER_GOOD:10,ADVANCED_MULT:1.5,LEVELS_XP_TABLE:it,API_BASE_URL:"https://api.pokersciences.com",DEBUG:!1,VERSION:typeof window!="undefined"&&(window.PS_VERSION||window.__PS_VERSION__)||"dev"};function V(t){return t&&typeof t=="object"&&!Object.isFrozen(t)&&(Object.freeze(t),Object.getOwnPropertyNames(t).forEach(e=>{t.hasOwnProperty(e)&&V(t[e])})),t}function ct(){let t=JSON.parse(JSON.stringify(lt));return V(t)}var ut={get:ct},b=ut;var $={};st($,{$:()=>c,$$:()=>A,clamp:()=>J,default:()=>dt,log:()=>v,on:()=>N,randomNonce:()=>F,round:()=>Z,setText:()=>p,setWidth:()=>L,toggle:()=>X});function c(t,e=document){return e.querySelector(t)}function A(t,e=document){return Array.from(e.querySelectorAll(t))}function N(t,e,n){t&&t.addEventListener(e,n)}function p(t,e){t&&(t.textContent=String(e))}function L(t,e){if(!t)return;let n=Math.max(0,Math.min(100,Number(e)||0));t.style.width=`${n}%`}function X(t,e){t&&(t.style.display=e?"":"none")}function J(t,e,n){return Math.max(e,Math.min(n,t))}function Z(t,e=1){return e<=0?t:Math.round(t/e)*e}function v(...t){try{let{DEBUG:e}=b.get();e&&console.log("[PS-Trainer]",...t)}catch(e){}}function F(t=12){let e=new Uint8Array(t);if(typeof crypto!="undefined"&&crypto.getRandomValues)crypto.getRandomValues(e);else for(let o=0;o<t;o+=1)e[o]=Math.floor(Math.random()*256);return btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"").slice(0,t)}var ft={$:c,$$:A,on:N,setText:p,setWidth:L,toggle:X,clamp:J,round:Z,log:v,randomNonce:F},dt=ft;function mt(){try{let t=Intl.DateTimeFormat().resolvedOptions().timeZone;if(t&&typeof t=="string")return t}catch(t){v("Impossible de d\xE9tecter le TZ, fallback UTC")}return"UTC"}function G(t,e){let n=typeof t=="number"?new Date(t):new Date(t);return new Intl.DateTimeFormat("en-CA",{timeZone:e,year:"numeric",month:"2-digit",day:"2-digit"}).format(n)}function Q(t){if(!t||typeof t!="string")return null;let[e,n,o]=t.split("-").map(a=>Number(a));return!Number.isFinite(e)||!Number.isFinite(n)||!Number.isFinite(o)?null:{y:e,m:n,d:o}}function pt(t,e){let n=Q(t),o=Q(e);if(!n||!o)return NaN;let a=Date.UTC(n.y,n.m-1,n.d),r=Date.UTC(o.y,o.m-1,o.d),m=Math.abs(r-a);return Math.floor(m/864e5)}function yt(t,e){return G(Date.now(),e)===t}var _t={getUserTZ:mt,toYMDInTZ:G,diffDaysYMD:pt,isTodayYMD:yt},E=_t;var Y="ps_profile_v1",z="ps_anon_id_v1",P={xp_total:0,level:1,flames:0,last_play_date:null};function H(){return typeof window=="undefined"?!1:!!(window.Memberstack||window.memberstack||window.MemberStack||window.$memberstackDom&&window.$memberstackDom.getCurrentMember)}async function ht(){var t,e;try{if(window.$memberstackDom&&window.$memberstackDom.getCurrentMember){let o=await window.$memberstackDom.getCurrentMember(),a=o&&(((t=o.data)==null?void 0:t.customFields)||o.customFields)||{},r=(...s)=>{for(let l of s){let i=a[l];if(i!=null&&String(i)!=="")return i}},m=r("xp_total","xpTotal","xp","xp-total"),u=r("level","niveau"),f=r("flames","flammes"),h=r("last_play_date","lastPlayDate","last_played","lastPlayed","last-play-date"),d={};if(m!==void 0&&(d.xp_total=Number(m)||0),u!==void 0&&(d.level=Number(u)||1),f!==void 0&&(d.flames=Number(f)||0),h!==void 0){let s=h;try{s instanceof Date?s=s.toISOString().slice(0,10):typeof s=="string"&&s.includes("T")&&(s=s.slice(0,10))}catch(l){}d.last_play_date=s||null}return d}let n=window.Memberstack||window.memberstack||window.MemberStack;if(n&&typeof n.getCustomFields=="function"){let o=await n.getCustomFields()||{},a={};return o.xp_total!==void 0&&(a.xp_total=Number(o.xp_total)||0),o["xp-total"]!==void 0&&(a.xp_total=Number(o["xp-total"])||0),o.level!==void 0&&(a.level=Number(o.level)||1),o.flames!==void 0&&(a.flames=Number(o.flames)||0),o.last_play_date!==void 0&&(a.last_play_date=o.last_play_date||null),o["last-play-date"]!==void 0&&(a.last_play_date=o["last-play-date"]||null),a}if(n&&typeof n.getCurrentMember=="function"){let o=await n.getCurrentMember(),a=o&&(o.customFields||((e=o.data)==null?void 0:e.customFields))||{},r={};return a.xp_total!==void 0&&(r.xp_total=Number(a.xp_total)||0),a["xp-total"]!==void 0&&(r.xp_total=Number(a["xp-total"])||0),a.level!==void 0&&(r.level=Number(a.level)||1),a.flames!==void 0&&(r.flames=Number(a.flames)||0),a.last_play_date!==void 0&&(r.last_play_date=a.last_play_date||null),a["last-play-date"]!==void 0&&(r.last_play_date=a["last-play-date"]||null),r}return null}catch(n){return v("Memberstack indisponible (lecture), utilisation du fallback localStorage."),null}}async function wt(t){try{let e={xp_total:String(t.xp_total||0),level:String(t.level||1),flames:String(t.flames||0),last_play_date:t.last_play_date||null};if(window.$memberstackDom&&window.$memberstackDom.updateCurrentMember){let o=k(_({},e),{flammes:e.flames,"xp-total":e.xp_total,xpTotal:e.xp_total,lastPlayDate:e.last_play_date,"last-play-date":e.last_play_date});return await window.$memberstackDom.updateCurrentMember({customFields:o}),!0}let n=window.Memberstack||window.memberstack||window.MemberStack;return n?typeof n.updateCustomFields=="function"?(await n.updateCustomFields(e),!0):typeof n.setCustomFields=="function"?(await n.setCustomFields(e),!0):typeof n.updateCurrentMember=="function"?(await n.updateCurrentMember({customFields:e}),!0):!1:!1}catch(e){return v("Memberstack indisponible (\xE9criture), fallback localStorage."),!1}}async function W(){let t=_({},P);try{let e=localStorage.getItem(Y);e&&(t=_(_({},t),JSON.parse(e)))}catch(e){v("Impossible de lire le profil localStorage, on repart sur les d\xE9fauts.")}if(H()){let e=await ht();if(e){let n=_({},t);e.xp_total!==void 0&&(t.xp_total===P.xp_total||t.xp_total===void 0)&&(n.xp_total=Number(e.xp_total)||0),e.level!==void 0&&(t.level===P.level||t.level===void 0)&&(n.level=Number(e.level)||1),e.flames!==void 0&&(t.flames===P.flames||t.flames===void 0)&&(n.flames=Number(e.flames)||0),e.last_play_date!==void 0&&(t.last_play_date===P.last_play_date||t.last_play_date===void 0)&&(n.last_play_date=e.last_play_date||null),t=n}}return t}async function K(t){let e=_(_({},P),t),n=H()&&await wt(e);try{localStorage.setItem(Y,JSON.stringify(e))}catch(o){}return n}async function xt(t){let e=await W(),n=_(_({},e),t);return await K(n),n}function gt(t,e){return!!(t&&e&&t.last_play_date===e)}async function bt(){var t;try{let e=window&&(window.Memberstack||window.memberstack)||null,n=await((t=e==null?void 0:e.getMemberId)==null?void 0:t.call(e));if(n)return String(n)}catch(e){}try{let e=localStorage.getItem(z);if(e)return e;let n=`anon_${Math.random().toString(36).slice(2,10)}`;return localStorage.setItem(z,n),n}catch(e){return`anon_${Math.random().toString(36).slice(2,10)}`}}var vt={loadProfile:W,saveProfile:K,patchProfile:xt,isTodayCredited:gt,getUserId:bt},g=vt;async function St(t,e={},n=8e3){let o=new AbortController,a=setTimeout(()=>o.abort(),n);try{return await fetch(t,k(_({},e),{signal:o.signal}))}finally{clearTimeout(a)}}async function j(t,{timeoutMs:e=8e3,retry:n=1}={}){let o=async()=>{let a=await St(t,{method:"GET"},e);if(!a.ok)throw new Error(`HTTP ${a.status}`);return a.json()};try{return await o()}catch(a){if(n>0)return v("Requ\xEAte \xE9chou\xE9e, on r\xE9essaie une fois...",t),o();throw a}}async function Nt(){let{API_BASE_URL:t}=b.get(),e=`${t}/chapters`;return j(e,{timeoutMs:8e3,retry:1})}async function Et({chapterId:t,limit:e}={}){if(!t)throw new Error("chapterId est requis");let n=b.get(),o=Number(e)||n.QUESTION_COUNT,a=F(),r=`${n.API_BASE_URL}/chapters/${encodeURIComponent(t)}/questions?limit=${encodeURIComponent(o)}&nonce=${encodeURIComponent(a)}`,m=await j(r,{timeoutMs:8e3,retry:1});return Array.isArray(m)?m:[]}var Mt={getChapters:Nt,getQuestions:Et},D=Mt;function tt(t){let{LEVELS_XP_TABLE:e}=b.get(),n=Math.max(0,Number(t)||0),o=1;for(let a=0;a<e.length;a+=1)n>=e[a]&&(o=a+1);return Math.max(1,Math.min(e.length,o))}function Tt(t){let{LEVELS_XP_TABLE:e}=b.get(),n=Math.max(0,Number(t)||0),o=tt(n),a=o-1,r=e[a],m=e[Math.min(a+1,e.length-1)],u=o===e.length,f=n-r,h=u?0:Math.max(0,m-n),d=u?1:Math.max(1,m-r),s=Math.max(0,Math.min(100,Math.round(f/d*100)));return{currentLevel:o,xpInLevel:f,xpToNext:h,percent:s}}function Ct({goodCount:t,advanced:e,flames:n}){let{XP_PER_GOOD:o,ADVANCED_MULT:a}=b.get(),r=(Number(t)||0)*o,m=e?a:1,u=(Number(n)||0)===0?1:Math.max(1,Number(n)),f=Math.round(r*m*u);return{base:r,multMode:m,multFlames:u,total:f}}function Pt(t,e){if(!t||!e)return!1;let n=m=>{let[u,f,h]=String(m).split("-").map(d=>Number(d));return Date.UTC(u,(f||1)-1,h||1)},o=n(t),a=n(e);return Math.floor(Math.abs(a-o)/864e5)>=2}function It(t,e){if(!t||!e||t.last_play_date===e)return t;let n=_({},t);return n.flames=Math.max(0,Number(n.flames)||0)+1,n.last_play_date=e,n}var Lt={levelFromXP:tt,progressInLevel:Tt,sessionXP:Ct,shouldResetFlames:Pt,applyDailyFlame:It},S=Lt;var w=null;function Dt(t,e){let n=Date.now();w={index:0,total:0,goodCount:0,mode:e==="advanced",chapterId:t||null,startedAt:n}}function kt(t){w&&t&&(w.goodCount+=1)}function At(){w&&(w.index+=1)}function Ft(t){w&&(w.total=Math.max(0,Number(t)||0))}function $t(){return w?_({},w):null}function Ot(t){if(!w)return null;let e=Date.now(),n={goodCount:w.goodCount,total:w.total,advanced:!!w.mode,chapterTitle:t||"",startedAt:w.startedAt,endedAt:e};try{sessionStorage.setItem("ps_session_summary_v1",JSON.stringify(n))}catch(a){}let o=_({},n);return w=null,o}var Ut={start:Dt,answer:kt,next:At,setTotal:Ft,getState:$t,finish:Ot},M=Ut;var et="[data-trainer-flames]";async function Rt(){let t=c(et);if(t)try{let e=await g.loadProfile();p(t,Number(e.flames)||0)}catch(e){p(t,"0")}}async function Bt(){let t=c(et);if(!t)return;let e=await g.loadProfile(),n=E.getUserTZ(),o=E.toYMDInTZ(Date.now(),n);Number(e.flames)>0&&S.shouldResetFlames(e.last_play_date,o)&&await g.patchProfile({flames:0});let a=await g.loadProfile();p(t,Number(a.flames)||0)}var qt={init:Rt,refresh:Bt},T=qt;function Vt(){try{let t=sessionStorage.getItem("ps_session_summary_v1");return t?JSON.parse(t):null}catch(t){return null}}async function Xt(){let t=c("[data-trainer-level-name]"),e=c("[data-trainer-level-bar]"),n=c("[data-trainer-level-fill]"),o=c("[data-trainer-level-percent]"),a=c("[data-trainer-play]"),r=c('[data-mode="simple"]'),m=c('[data-mode="advanced"]');if(!t&&!e&&!a)return;let u=await g.loadProfile(),{currentLevel:f,percent:h}=S.progressInLevel(u.xp_total);p(t,`Niveau ${f}`),L(n,h),p(o,`${h}%`);let d=[];try{d=await D.getChapters()}catch(i){}let s=c("[data-trainer-chapters]");if(s&&s.tagName==="SELECT")s.innerHTML="",d.forEach(i=>{let y=document.createElement("option");y.value=i.id,y.textContent=i.title||i.slug||i.id,s.appendChild(y)});else{let i=c("[data-trainer-chapters-list]");i&&(i.innerHTML="",d.forEach(y=>{let x=document.createElement("div");x.setAttribute("data-chapter-id",y.id),x.textContent=y.title||y.slug||y.id,i.appendChild(x)}))}let l="simple";N(r,"click",()=>{l="simple"}),N(m,"click",()=>{l="advanced"}),N(a,"click",()=>{let i=null;if(s&&s.tagName==="SELECT")i=s.value||null;else{let y=c("[data-trainer-chapters-list] [data-chapter-id].selected");i=y?y.getAttribute("data-chapter-id"):null}!i&&d[0]&&(i=d[0].id);try{sessionStorage.setItem("ps_lobby_choice_v1",JSON.stringify({chapterId:i,mode:l}))}catch(y){}window.location.href="/trainer/questions"})}async function Jt(){let t=c("[data-q-stem]"),e=A("[data-q-choice]"),n=c("[data-q-feedback]"),o=c("[data-q-correct]"),a=c("[data-q-next]");if(!t&&!a)return;let r=null;try{r=JSON.parse(sessionStorage.getItem("ps_lobby_choice_v1"))}catch(l){}if(!r||!r.chapterId){window.location.href="/trainer/lobby";return}let m=b.get();M.start(r.chapterId,r.mode);let u=[];try{u=await D.getQuestions({chapterId:r.chapterId,limit:m.QUESTION_COUNT})}catch(l){u=[]}if(!Array.isArray(u)||u.length===0){window.location.href="/trainer/lobby";return}M.setTotal(u.length);let f=0,h=!1;function d(l){if(!l)return;p(t,l.stem||"");let i=Array.isArray(l.choices)?l.choices:[];["A","B","C","D"].forEach((x,C)=>{let U=document.querySelector(`[data-q-choice="${x}"]`);U&&p(U,i[C]||"")}),n&&(n.style.display="none"),o&&p(o,""),h=!1}function s(l,i){var y;if(n){if(n.style.display="",p(n,i?"Bonne r\xE9ponse \u2705":"Mauvaise r\xE9ponse \u274C"),o){let x=Number(l.correctIndex),C=Array.isArray(l.choices)?l.choices:[];p(o,`Solution: ${(y=C[x])!=null?y:""}`)}h=!0}}["A","B","C","D"].forEach((l,i)=>{let y=document.querySelector(`[data-q-choice="${l}"]`);N(y,"click",()=>{if(h)return;let x=u[f],C=Number(x.correctIndex)===i;M.answer(C),s(x,C)})}),N(a,"click",()=>{var l;if(h){if(f+=1,M.next(),f>=u.length){let i=((l=u[0])==null?void 0:l.chapterTitle)||"";M.finish(i),window.location.href="/trainer/results";return}d(u[f])}}),d(u[f])}async function Zt(){let t=c("[data-r-score]"),e=c("[data-r-xp-base]"),n=c("[data-r-mult-flames]"),o=c("[data-r-mult-mode]"),a=c("[data-r-xp-total]"),r=c("[data-trainer-level-name]"),m=c("[data-trainer-level-fill]"),u=c("[data-trainer-level-percent]");if(!t&&!a&&!r)return;let f=Vt();if(!f){window.location.href="/trainer/lobby";return}let h=E.getUserTZ(),d=E.toYMDInTZ(Date.now(),h),s=await g.loadProfile();S.shouldResetFlames(s.last_play_date,d)&&(s=await g.patchProfile({flames:0})),g.isTodayCredited(s,d)||(s=await g.patchProfile({flames:Math.max(0,Number(s.flames)||0)+1,last_play_date:d}));let l=S.sessionXP({goodCount:f.goodCount,advanced:f.advanced,flames:s.flames}),i=Math.max(0,Number(s.xp_total)||0)+l.total,y=S.levelFromXP(i);s=await g.patchProfile({xp_total:i,level:y}),p(t,`${f.goodCount}/${f.total}`),p(e,`${l.base}`),p(n,`\xD7${l.multFlames}`),p(o,`\xD7${l.multMode}`),p(a,`${l.total}`);let x=S.progressInLevel(s.xp_total);p(r,`Niveau ${x.currentLevel}`),L(m,x.percent),p(u,`${x.percent}%`)}var Qt={initLobby:Xt,initQuestions:Jt,initResults:Zt},I=Qt;function Gt(){document.addEventListener("DOMContentLoaded",async()=>{try{await T.init(),await T.refresh()}catch(t){}try{setTimeout(()=>{T.refresh()},1500)}catch(t){}try{setTimeout(()=>{T.refresh()},4e3)}catch(t){}try{await I.initLobby()}catch(t){}try{await I.initQuestions()}catch(t){}try{await I.initResults()}catch(t){}})}var zt={boot:Gt},O=zt;typeof window!="undefined"&&(window.PokerSciences=window.PokerSciences||{},window.PokerSciences.Trainer={Config:b,Utils:$,Time:E,Storage:g,Data:D,Progress:S,Session:M,Navbar:T,Pages:I,Boot:O});O.boot();})();
