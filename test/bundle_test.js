/* env:test version:v-2025-08-25-15-19-animation-opacite-flammes-plus-longue */
(()=>{var q=Object.defineProperty,at=Object.defineProperties;var rt=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var st=Object.prototype.hasOwnProperty,it=Object.prototype.propertyIsEnumerable;var J=(t,e,n)=>e in t?q(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,h=(t,e)=>{for(var n in e||(e={}))st.call(e,n)&&J(t,n,e[n]);if(B)for(var n of B(e))it.call(e,n)&&J(t,n,e[n]);return t},V=(t,e)=>at(t,rt(e));var lt=(t,e)=>{for(var n in e)q(t,n,{get:e[n],enumerable:!0})};var ct=(()=>{let t=[0],e=0,n=50;for(let o=1;o<35;o+=1)e+=n,t.push(e),n+=10;return t})(),ut={QUESTION_COUNT:20,XP_PER_GOOD:10,ADVANCED_MULT:1.5,LEVELS_XP_TABLE:ct,API_BASE_URL:"https://api.pokersciences.com",DEBUG:!1,VERSION:typeof window!="undefined"&&(window.PS_VERSION||window.__PS_VERSION__)||"dev"};function X(t){return t&&typeof t=="object"&&!Object.isFrozen(t)&&(Object.freeze(t),Object.getOwnPropertyNames(t).forEach(e=>{t.hasOwnProperty(e)&&X(t[e])})),t}function ft(){let t=JSON.parse(JSON.stringify(ut));return X(t)}var dt={get:ft},b=dt;var O={};lt(O,{$:()=>u,$$:()=>D,clamp:()=>Z,default:()=>pt,log:()=>S,on:()=>v,randomNonce:()=>F,round:()=>Q,setText:()=>p,setWidth:()=>I,toggle:()=>G});function u(t,e=document){return e.querySelector(t)}function D(t,e=document){return Array.from(e.querySelectorAll(t))}function v(t,e,n){t&&t.addEventListener(e,n)}function p(t,e){t&&(t.textContent=String(e))}function I(t,e){if(!t)return;let n=Math.max(0,Math.min(100,Number(e)||0));t.style.width=`${n}%`}function G(t,e){t&&(t.style.display=e?"":"none")}function Z(t,e,n){return Math.max(e,Math.min(n,t))}function Q(t,e=1){return e<=0?t:Math.round(t/e)*e}function S(...t){try{let{DEBUG:e}=b.get();e&&console.log("[PS-Trainer]",...t)}catch(e){}}function F(t=12){let e=new Uint8Array(t);if(typeof crypto!="undefined"&&crypto.getRandomValues)crypto.getRandomValues(e);else for(let o=0;o<t;o+=1)e[o]=Math.floor(Math.random()*256);return btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"").slice(0,t)}var mt={$:u,$$:D,on:v,setText:p,setWidth:I,toggle:G,clamp:Z,round:Q,log:S,randomNonce:F},pt=mt;function yt(){try{let t=Intl.DateTimeFormat().resolvedOptions().timeZone;if(t&&typeof t=="string")return t}catch(t){S("Impossible de d\xE9tecter le TZ, fallback UTC")}return"UTC"}function W(t,e){let n=typeof t=="number"?new Date(t):new Date(t);return new Intl.DateTimeFormat("en-CA",{timeZone:e,year:"numeric",month:"2-digit",day:"2-digit"}).format(n)}function z(t){if(!t||typeof t!="string")return null;let[e,n,o]=t.split("-").map(a=>Number(a));return!Number.isFinite(e)||!Number.isFinite(n)||!Number.isFinite(o)?null:{y:e,m:n,d:o}}function ht(t,e){let n=z(t),o=z(e);if(!n||!o)return NaN;let a=Date.UTC(n.y,n.m-1,n.d),r=Date.UTC(o.y,o.m-1,o.d),d=Math.abs(r-a);return Math.floor(d/864e5)}function wt(t,e){return W(Date.now(),e)===t}var gt={getUserTZ:yt,toYMDInTZ:W,diffDaysYMD:ht,isTodayYMD:wt},M=gt;var A="ps_profile_v1",Y="ps_anon_id_v1",H="ps_profile_pending_until_v1",_t=8e3,k={xp_total:0,level:1,flames:0,last_play_date:null};function K(){return typeof window=="undefined"?!1:!!(window.Memberstack||window.memberstack||window.MemberStack||window.$memberstackDom&&window.$memberstackDom.getCurrentMember)}async function xt(){var t,e;try{if(window.$memberstackDom&&window.$memberstackDom.getCurrentMember){let o=await window.$memberstackDom.getCurrentMember(),a=o&&(((t=o.data)==null?void 0:t.customFields)||o.customFields)||{},r=(...s)=>{for(let c of s){let i=a[c];if(i!=null&&String(i)!=="")return i}},d=r("xp_total","xpTotal","xp","xp-total"),l=r("level","niveau"),f=r("flames","flammes"),w=r("last_play_date","lastPlayDate","last_played","lastPlayed","last-play-date"),m={};if(d!==void 0&&(m.xp_total=Number(d)||0),l!==void 0&&(m.level=Number(l)||1),f!==void 0&&(m.flames=Number(f)||0),w!==void 0){let s=w;try{s instanceof Date?s=s.toISOString().slice(0,10):typeof s=="string"&&s.includes("T")&&(s=s.slice(0,10))}catch(c){}m.last_play_date=s||null}return m}let n=window.Memberstack||window.memberstack||window.MemberStack;if(n&&typeof n.getCustomFields=="function"){let o=await n.getCustomFields()||{},a={};return o.xp_total!==void 0&&(a.xp_total=Number(o.xp_total)||0),o["xp-total"]!==void 0&&(a.xp_total=Number(o["xp-total"])||0),o.level!==void 0&&(a.level=Number(o.level)||1),o.flames!==void 0&&(a.flames=Number(o.flames)||0),o.last_play_date!==void 0&&(a.last_play_date=o.last_play_date||null),o["last-play-date"]!==void 0&&(a.last_play_date=o["last-play-date"]||null),a}if(n&&typeof n.getCurrentMember=="function"){let o=await n.getCurrentMember(),a=o&&(o.customFields||((e=o.data)==null?void 0:e.customFields))||{},r={};return a.xp_total!==void 0&&(r.xp_total=Number(a.xp_total)||0),a["xp-total"]!==void 0&&(r.xp_total=Number(a["xp-total"])||0),a.level!==void 0&&(r.level=Number(a.level)||1),a.flames!==void 0&&(r.flames=Number(a.flames)||0),a.last_play_date!==void 0&&(r.last_play_date=a.last_play_date||null),a["last-play-date"]!==void 0&&(r.last_play_date=a["last-play-date"]||null),r}return null}catch(n){return S("Memberstack indisponible (lecture), utilisation du fallback localStorage."),null}}async function bt(t){var e;try{let n={xp_total:t.xp_total!=null?String(t.xp_total):void 0,level:t.level!=null?String(t.level):void 0,flames:t.flames!=null?String(t.flames):void 0,last_play_date:t.last_play_date||void 0},o=window.$memberstackDom;if(o){let r={};n.flames!==void 0&&(r.flames=n.flames,r.flammes=n.flames),n.xp_total!==void 0&&(r["xp-total"]=n.xp_total,r.xpTotal=n.xp_total),n.last_play_date!==void 0&&(r["last-play-date"]=n.last_play_date,r.lastPlayDate=n.last_play_date),n.level!==void 0&&(r.level=n.level);try{await((e=o.getCurrentMember)==null?void 0:e.call(o))}catch(l){}let d=[async()=>typeof o.updateMember=="function"&&await o.updateMember({customFields:r}),async()=>typeof o.updateMemberJSON=="function"&&await o.updateMemberJSON({customFields:r}),async()=>typeof o.setCustomFields=="function"&&await o.setCustomFields(r),async()=>typeof o.updateCustomFields=="function"&&await o.updateCustomFields(r),async()=>typeof o.updateMemberJSON=="function"&&await o.updateMemberJSON(r)];for(let l=0;l<d.length;l+=1){let f=d[l];try{if(await(f==null?void 0:f())!==!1)return!0}catch(w){}}}let a=window.Memberstack||window.memberstack||window.MemberStack;return a?typeof a.updateCustomFields=="function"?(await a.updateCustomFields(n),!0):typeof a.setCustomFields=="function"?(await a.setCustomFields(n),!0):typeof a.updateCurrentMember=="function"?(await a.updateCurrentMember({customFields:n}),!0):!1:!1}catch(n){return S("Memberstack indisponible (\xE9criture), fallback localStorage."),!1}}async function j(){let t=h({},k),e=!1;try{let o=localStorage.getItem(A);o&&(t=h(h({},t),JSON.parse(o)))}catch(o){S("Impossible de lire le profil localStorage, on repart sur les d\xE9fauts.")}let n=!1;try{let o=Number(localStorage.getItem(H)||0);o&&Date.now()<o&&(n=!0)}catch(o){}if(!n&&K()){let o=await xt();o&&(t=h(h({},t),o),e=!0)}if(e)try{localStorage.setItem(A,JSON.stringify(t))}catch(o){}return t}async function St(){try{let t=localStorage.getItem(A);if(t)return h(h({},k),JSON.parse(t))}catch(t){}return h({},k)}async function tt(t){let e=h(h({},k),t),n=K()&&await bt(e);try{localStorage.setItem(A,JSON.stringify(e));let o=n?3e3:_t;localStorage.setItem(H,String(Date.now()+o))}catch(o){}return n}async function Nt(t){let e=await j(),n=h(h({},e),t);return await tt(n),n}function vt(t,e){return!!(t&&e&&t.last_play_date===e)}async function Mt(){var t;try{let e=window&&(window.Memberstack||window.memberstack)||null,n=await((t=e==null?void 0:e.getMemberId)==null?void 0:t.call(e));if(n)return String(n)}catch(e){}try{let e=localStorage.getItem(Y);if(e)return e;let n=`anon_${Math.random().toString(36).slice(2,10)}`;return localStorage.setItem(Y,n),n}catch(e){return`anon_${Math.random().toString(36).slice(2,10)}`}}var Et={loadProfile:j,loadProfileFast:St,saveProfile:tt,patchProfile:Nt,isTodayCredited:vt,getUserId:Mt},x=Et;async function Tt(t,e={},n=8e3){let o=new AbortController,a=setTimeout(()=>o.abort(),n);try{return await fetch(t,V(h({},e),{signal:o.signal}))}finally{clearTimeout(a)}}async function et(t,{timeoutMs:e=8e3,retry:n=1}={}){let o=async()=>{let a=await Tt(t,{method:"GET"},e);if(!a.ok)throw new Error(`HTTP ${a.status}`);return a.json()};try{return await o()}catch(a){if(n>0)return S("Requ\xEAte \xE9chou\xE9e, on r\xE9essaie une fois...",t),o();throw a}}async function Ct(){let{API_BASE_URL:t}=b.get(),e=`${t}/chapters`;return et(e,{timeoutMs:8e3,retry:1})}async function Pt({chapterId:t,limit:e}={}){if(!t)throw new Error("chapterId est requis");let n=b.get(),o=Number(e)||n.QUESTION_COUNT,a=F(),r=`${n.API_BASE_URL}/chapters/${encodeURIComponent(t)}/questions?limit=${encodeURIComponent(o)}&nonce=${encodeURIComponent(a)}`,d=await et(r,{timeoutMs:8e3,retry:1});return Array.isArray(d)?d:[]}var It={getChapters:Ct,getQuestions:Pt},L=It;function nt(t){let{LEVELS_XP_TABLE:e}=b.get(),n=Math.max(0,Number(t)||0),o=1;for(let a=0;a<e.length;a+=1)n>=e[a]&&(o=a+1);return Math.max(1,Math.min(e.length,o))}function Lt(t){let{LEVELS_XP_TABLE:e}=b.get(),n=Math.max(0,Number(t)||0),o=nt(n),a=o-1,r=e[a],d=e[Math.min(a+1,e.length-1)],l=o===e.length,f=n-r,w=l?0:Math.max(0,d-n),m=l?1:Math.max(1,d-r),s=Math.max(0,Math.min(100,Math.round(f/m*100)));return{currentLevel:o,xpInLevel:f,xpToNext:w,percent:s}}function Dt({goodCount:t,advanced:e,flames:n}){let{XP_PER_GOOD:o,ADVANCED_MULT:a}=b.get(),r=(Number(t)||0)*o,d=e?a:1,l=(Number(n)||0)===0?1:Math.max(1,Number(n)),f=Math.round(r*d*l);return{base:r,multMode:d,multFlames:l,total:f}}function Ft(t,e){if(!t||!e)return!1;let n=d=>{let[l,f,w]=String(d).split("-").map(m=>Number(m));return Date.UTC(l,(f||1)-1,w||1)},o=n(t),a=n(e);return Math.floor(Math.abs(a-o)/864e5)>=2}function At(t,e){if(!t||!e||t.last_play_date===e)return t;let n=h({},t);return n.flames=Math.max(0,Number(n.flames)||0)+1,n.last_play_date=e,n}var kt={levelFromXP:nt,progressInLevel:Lt,sessionXP:Dt,shouldResetFlames:Ft,applyDailyFlame:At},N=kt;var g=null;function Ot(t,e){let n=Date.now();g={index:0,total:0,goodCount:0,mode:e==="advanced",chapterId:t||null,startedAt:n}}function $t(t){g&&t&&(g.goodCount+=1)}function Ut(){g&&(g.index+=1)}function Rt(t){g&&(g.total=Math.max(0,Number(t)||0))}function Bt(){return g?h({},g):null}function Jt(t){if(!g)return null;let e=Date.now(),n={goodCount:g.goodCount,total:g.total,advanced:!!g.mode,chapterTitle:t||"",startedAt:g.startedAt,endedAt:e};try{sessionStorage.setItem("ps_session_summary_v1",JSON.stringify(n))}catch(a){}let o=h({},n);return g=null,o}var qt={start:Ot,answer:$t,next:Ut,setTotal:Rt,getState:Bt,finish:Jt},E=qt;var ot="[data-trainer-flames]";async function $(t,e,n=!0){if(!t)return;let o=String(Number(e)||0),a=String((t.textContent||"").trim());if(t.setAttribute("data-ready","1"),!n||a===""||a===o){p(t,o),t.style.opacity="1";return}try{t.style.transition||(t.style.transition="opacity 400ms ease"),t.style.opacity="1",t.style.opacity="0",await new Promise(r=>setTimeout(r,410)),p(t,o),t.style.opacity="1",await new Promise(r=>setTimeout(r,410))}catch(r){p(t,o),t.style.opacity="1"}}async function Vt(){let t=u(ot);if(t)try{let e=await x.loadProfileFast();await $(t,Number(e.flames)||0,!1)}catch(e){await $(t,0,!1)}}async function Xt(){let t=u(ot);if(!t)return;let e=await x.loadProfile(),n=M.getUserTZ(),o=M.toYMDInTZ(Date.now(),n);Number(e.flames)>0&&N.shouldResetFlames(e.last_play_date,o)&&await x.patchProfile({flames:0});let a=await x.loadProfile();await $(t,Number(a.flames)||0,!0)}var Gt={init:Vt,refresh:Xt},T=Gt;function Zt(){try{let t=sessionStorage.getItem("ps_session_summary_v1");return t?JSON.parse(t):null}catch(t){return null}}async function Qt(){let t=u("[data-trainer-level-name]"),e=u("[data-trainer-level-bar]"),n=u("[data-trainer-level-fill]"),o=u("[data-trainer-level-percent]"),a=u("[data-trainer-play]"),r=u('[data-mode="simple"]'),d=u('[data-mode="advanced"]');if(!t&&!e&&!a)return;let l=await x.loadProfile(),{currentLevel:f,percent:w}=N.progressInLevel(l.xp_total);p(t,`Niveau ${f}`),I(n,w),p(o,`${w}%`);let m=[];try{m=await L.getChapters()}catch(i){}let s=u("[data-trainer-chapters]");if(s&&s.tagName==="SELECT")s.innerHTML="",m.forEach(i=>{let y=document.createElement("option");y.value=i.id,y.textContent=i.title||i.slug||i.id,s.appendChild(y)});else{let i=u("[data-trainer-chapters-list]");i&&(i.innerHTML="",m.forEach(y=>{let _=document.createElement("div");_.setAttribute("data-chapter-id",y.id),_.textContent=y.title||y.slug||y.id,i.appendChild(_)}))}let c="simple";v(r,"click",()=>{c="simple"}),v(d,"click",()=>{c="advanced"}),v(a,"click",()=>{let i=null;if(s&&s.tagName==="SELECT")i=s.value||null;else{let y=u("[data-trainer-chapters-list] [data-chapter-id].selected");i=y?y.getAttribute("data-chapter-id"):null}!i&&m[0]&&(i=m[0].id);try{sessionStorage.setItem("ps_lobby_choice_v1",JSON.stringify({chapterId:i,mode:c}))}catch(y){}window.location.href="/trainer/questions"})}async function zt(){let t=u("[data-q-stem]"),e=D("[data-q-choice]"),n=u("[data-q-feedback]"),o=u("[data-q-correct]"),a=u("[data-q-next]");if(!t&&!a)return;let r=null;try{r=JSON.parse(sessionStorage.getItem("ps_lobby_choice_v1"))}catch(c){}if(!r||!r.chapterId){window.location.href="/trainer/lobby";return}let d=b.get();E.start(r.chapterId,r.mode);let l=[];try{l=await L.getQuestions({chapterId:r.chapterId,limit:d.QUESTION_COUNT})}catch(c){l=[]}if(!Array.isArray(l)||l.length===0){window.location.href="/trainer/lobby";return}E.setTotal(l.length);let f=0,w=!1;function m(c){if(!c)return;p(t,c.stem||"");let i=Array.isArray(c.choices)?c.choices:[];["A","B","C","D"].forEach((_,C)=>{let R=document.querySelector(`[data-q-choice="${_}"]`);R&&p(R,i[C]||"")}),n&&(n.style.display="none"),o&&p(o,""),w=!1}function s(c,i){var y;if(n){if(n.style.display="",p(n,i?"Bonne r\xE9ponse \u2705":"Mauvaise r\xE9ponse \u274C"),o){let _=Number(c.correctIndex),C=Array.isArray(c.choices)?c.choices:[];p(o,`Solution: ${(y=C[_])!=null?y:""}`)}w=!0}}["A","B","C","D"].forEach((c,i)=>{let y=document.querySelector(`[data-q-choice="${c}"]`);v(y,"click",()=>{if(w)return;let _=l[f],C=Number(_.correctIndex)===i;E.answer(C),s(_,C)})}),v(a,"click",()=>{var c;if(w){if(f+=1,E.next(),f>=l.length){let i=((c=l[0])==null?void 0:c.chapterTitle)||"";E.finish(i),window.location.href="/trainer/results";return}m(l[f])}}),m(l[f])}async function Wt(){let t=u("[data-r-score]"),e=u("[data-r-xp-base]"),n=u("[data-r-mult-flames]"),o=u("[data-r-mult-mode]"),a=u("[data-r-xp-total]"),r=u("[data-trainer-level-name]"),d=u("[data-trainer-level-fill]"),l=u("[data-trainer-level-percent]");if(!t&&!a&&!r)return;let f=Zt();if(!f){window.location.href="/trainer/lobby";return}let w=M.getUserTZ(),m=M.toYMDInTZ(Date.now(),w),s=await x.loadProfile();N.shouldResetFlames(s.last_play_date,m)&&(s=await x.patchProfile({flames:0})),x.isTodayCredited(s,m)||(s=await x.patchProfile({flames:Math.max(0,Number(s.flames)||0)+1,last_play_date:m}));let c=N.sessionXP({goodCount:f.goodCount,advanced:f.advanced,flames:s.flames}),i=Math.max(0,Number(s.xp_total)||0)+c.total,y=N.levelFromXP(i);s=await x.patchProfile({xp_total:i,level:y}),p(t,`${f.goodCount}/${f.total}`),p(e,`${c.base}`),p(n,`\xD7${c.multFlames}`),p(o,`\xD7${c.multMode}`),p(a,`${c.total}`);let _=N.progressInLevel(s.xp_total);p(r,`Niveau ${_.currentLevel}`),I(d,_.percent),p(l,`${_.percent}%`)}var Yt={initLobby:Qt,initQuestions:zt,initResults:Wt},P=Yt;function Ht(){async function t(){try{await T.init(),await T.refresh()}catch(e){}try{setTimeout(()=>{T.refresh()},1500)}catch(e){}try{setTimeout(()=>{T.refresh()},4e3)}catch(e){}try{await P.initLobby()}catch(e){}try{await P.initQuestions()}catch(e){}try{await P.initResults()}catch(e){}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",t):t()}var Kt={boot:Ht},U=Kt;typeof window!="undefined"&&(window.PokerSciences=window.PokerSciences||{},window.PokerSciences.Trainer={Config:b,Utils:O,Time:M,Storage:x,Data:L,Progress:N,Session:E,Navbar:T,Pages:P,Boot:U});U.boot();})();
